<script>
  let activate_result = false;

  function getErrorMessage(errorType) {
    const errorMessages = {
      "startDateMissing": "예약 활성화 시작일을 선택해 주세요.",
      "endDateMissing": "예약 활성화 종료일을 선택해 주세요.",
      "dateNotSelected": "예약 날짜를 선택해 주세요."

    };

    return errorMessages[errorType] || "알 수 없는 오류가 발생했습니다.";
  }


  function validateDates(start, end) {
    console.log("start", start);
    console.log("end", end);
    // 날짜가 선택되지 않은 경우
    if (!start || isNaN(new Date(start).getTime())) {
      return { valid: false, errorType: "startDateMissing" };
    }
    if (!end || isNaN(new Date(end).getTime())) {
      return { valid: false, errorType: "endDateMissing" };
    }

    // 시작일과 종료일을 Date 객체로 변환
    const start_type_date = new Date(start);
    const end_type_date = new Date(end);
    // const disableStart = new Date(disableStartDate);
    // const disableEnd = new Date(disableEndDate);

    // // 시작일이 종료일보다 늦은 경우
    // if (start_type_date > end_type_date) {
    //     return { valid: false, errorType: "startAfterEnd" };
    // }

    // // 예약 가능한 날짜 범위를 벗어난 경우
    // if (start_type_date < disableStart || end_type_date > disableEnd) {
    //     return { valid: false, errorType: "dateNotInRange" };
    // }

    // 모든 유효성 검사를 통과한 경우
    return { valid: true };
  }

  function activateHandle() {
    rsv_activate.addEventListener("click", function () {
      // console.log("activate_start", activate_start);
      // console.log("activate_end", activate_end);
      // validateDates 함수의 결과를 사용하여 유효성 검사를 수행합니다.
      let activate_start = disable_date_start.textContent;
      let activate_end = disable_date_end.textContent;
      const validationResult = validateDates(activate_start, activate_end);

      // 유효하지 않은 경우, getErrorMessage 함수를 사용하여 오류 메시지를 가져와 알립니다.
      if (!validationResult.valid) {
        const errorMessage = getErrorMessage(validationResult.errorType); // 오류 유형에 따라 메시지를 가져옵니다.
        alert(errorMessage);
        return;
      }

      // 유효성 검사를 통과한 경우의 처리 로직을 작성합니다.
      const activateResult = confirm("활성화 하시겠습니까?");
      if (activateResult) {
        console.log("활성화 온");
        activatePost(activate_start, activate_end);
      }
    });
  }
  activateHandle();
  // function activateHandle() {

  //   rsv_activate.addEventListener("click", function () {

  //     if (activate_start && activate_end) {
  //       activate_result = confirm("활성화 하시겠습니까?");
  //       if (activate_result) {
  //         activatePost(activate_start, activate_end);
  //         return;
  //       }
  //     } else if (disable_date_start.textContent) {
  //       alert("예약 활성화 종료일을 선택해 주세요.")
  //       return;
  //     } else if (disable_date_end.textContent) {
  //       alert("예약 활성화 시작일을 선택해 주세요.")
  //       return;
  //     } else {
  //       alert("예약 날짜를 선택해 주세요.")
  //       return;
  //     }
  //     // console.log("실행되냐");
  //   })
  // }
  // activateHandle();

  function activatePost(start, end) {
    fetch("api/activate_post/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": getCookie("csrftoken"),
      },
      body: JSON.stringify({
        "activate_date_start": start,
        "activate_date_end": end,
      })
    })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.log(error));
  }
</script>